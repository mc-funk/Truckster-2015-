{% extends "base.html" %}
{% block content %}
<!-- <head meta name="viewport" content="width=device-width, initial-scale=1">-->

    <link href="/truckster/truckster/styles/leaflet.css" rel="stylesheet">
<style>
  #map { height: 400px; padding-left: 20px; border: 1px solid #000000; }
</style>
  <div class="row">
    <div class="col-md-8" id="map">
    </div>
    <div class="col-md-4 rsidebar sidebar">
      <div class="sidebar-box featured-truck">
        <h4>Featured Truck</h4>
        <img src="/truckster/truckster/assets/WorldStreetKitchentruck_150h.png">
        <p>World Street Kitchen! It has tasty foods.</p>
      </div>
      <div class="sidebar-box about">
        Love food trucks? Now you can stalk them -- without all the work.
        Truckster will notify you when your favorite food trucks are open
        near the places where you work and play. <a href="#">Sign up today!</a>
      </div>
      <div class="sidebar-box search-box">
        <p class="truck-search-zip"><input type="text" placeholder="Search by zip code"><button name="by-zip" type="submit" class="btn btn-success btn-sm">Go</button></input></p>
        <p class="truck-search-name"><input type="text" placeholder="Search by truck name"><button name="by-name" type="submit" class="btn btn-success btn-sm">Go</button></input></p>
        <p class="browse-by-truck">
            <a href="#"><button class="btn btn-primary btn-sm">Browse by truck</button></a>
        </p>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="/truckster/truckster/scripts/leaflet.js"></script>
<script type="text/javascript" src="/truckster/truckster/scripts/truckster-scripts.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
    console.log("document ready");

    var AllTruckData = jQuery.get("https://exo-foodtruck.firebaseio.com/trucks.json");
    var zoomLevel = 9;
    var exositeHomeGPS = [44.98014269999999,-93.28874739999999];
    // set up the map
    map = new L.Map('map');

    // create the tile layer with correct attribution
    var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    var osmAttrib='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
    var osm = new L.TileLayer(osmUrl, {minZoom: 8, maxZoom: 12, attribution: osmAttrib});

    function initmap() {

      // start the map in South-East England
        map.setView(exositeHomeGPS,zoomLevel);
        map.addLayer(osm);
      }

    function add_food_trucks_to_map() {
      $.each(AllTruckData.responseJSON, function(idx, val) {
        console.log("RID: ", idx, "Food Truck: ", val['name'])
        var circle = L.circle(  [ val['status']['gps']['lat'],
                                  val['status']['gps']['long']
                                ],
                     500, {
          color: 'blue',
          fillColor: '#f03',
          fillOpacity: 0.5
        }).addTo(map);

        popupContent = '<p>' + val['name'] +'<br />'+ '<button type="button">Stalk this Truck!</button></p>';
        circle.bindPopup(popupContent);
          // .setContent('<p>' + val['name'] +'<br />'+ '<button type="button">' + Stalk this Truck! + '</button></p>');
      });
    }

    initmap();
    jQuery.when(AllTruckData).done(add_food_trucks_to_map)


    // console.log(AllTruckData.responseJSON)
    // $.each(AllTruckData.responseJSON, function(idx, val) {
    //   console.log("RID: ", idx, "Food Truck: ", val['name'])
    // });




  });
</script>

</body>
</html>

{% endblock %}
